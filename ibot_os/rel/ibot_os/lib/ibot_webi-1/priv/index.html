<!DOCTYPE HTML>
<html>
<head>
    <link rel="stylesheet" href="/cssStyle" />
    <script type="text/javascript" src="/jsJquery"></script>
<script type="text/javascript">
var ws = new Object;

/*Open websocket connection to iBotOS core*/
function open()
{
    if (!("WebSocket" in window)) {
        alert("WebSocket NOT supported by your Browser!");
        return;
    }
    console.log('open');
    ws = new WebSocket("ws://"+window.location.host+"/websocket");
    ws.onopen = function() {
        console.log('connected');
    };
    ws.onmessage = function (evt)
    {
        var received_msg = evt.data;
        console.log("Received: " + received_msg);

        var txt = document.createTextNode("Got from server: " + received_msg);
        document.getElementById('messages').appendChild(txt);

        $('#nodeListDiv').html(received_msg);
        var response = JSON.parse(received_msg);

        switch (response['responseType'])
        {
            case "nodeslist" :
                $('#nodeListDiv').html(response);
                var nodesList = response['responseJson'].split("&");
                $('#nodeListDiv').html(nodesList);
                var nodeListHtml = "";
                    for(var i=1; i<nodesList.length; i++)
                    nodeListHtml += generateNodeItem(nodesList[i]);
                    $('#nodeListDiv').html(nodeListHtml);
                break;
        }
    };
    ws.onclose = function()
    {
        // websocket is closed.
        console.log('close');
    };
}

function sendData()
{
    var jsonQ = "{\"sendData\" : {\"sendType\" : \""+ "broadcast" +
            "\", \"topicName\" : \"" + "testTopic" + "\", \"message\" : [\"one\"]}}";
    ws.send(jsonQ);
    console.log(jsonQ);
}

    /*Load connect to project page*/
    function loadConnectToProject()
    {
        $('#contentDiv').load('/pageConnectToProject');
    }

    /*Loanf create new project page*/
    function loadCreateProject()
    {
        $('#contentDiv').load('/pageCreateProject');
    }

    /*Load create new node page*/
    function loadCreateNode()
    {
        $('#contentDiv').load('/pageCreateNode');
    }

    /*Load project nodes list page*/
    function loadProjectNodes()
    {
        $('#contentDiv').load('/pageNodeList', function () {
            ws.send("{\"getNodes\" : \"\"}");
        });
    }
</script>
</head>
<body>
<div id="sse">
   <a href="javascript:open()">Open WebSocket</a><br/>
    <a href="javascript:sendData()">Send Data</a><br/>
    <a href="javascript:loadConnectToProject()">Connect to project</a><br/>
    <a href="javascript:loadCreateProject()">Create project</a><br/>
    <a href="javascript:loadCreateNode()">Create node</a><br/>
    <a href="javascript:loadProjectNodes()">Project node list</a><br/>
    <br />
    <div id="contentDiv" class="contentDiv">

    </div>
</div>
<div id="messages">
</div>
</body>
</html>
